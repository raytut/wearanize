Title: Healthy Brain study wearable data requests, integration, synchronization and access

Who: 
	Frederik D. Weber
	Rayyan Tutunji

Original Goals:	
1. preprocess raw data from wearable/mobile devices
2. synchronize data from four wearable/mobile devices within a time-series database
3. software to support researchers by facilitating data access requests
4. (do so in python package)

Suggested code names for software:
	wearanize - wearable data synchronized
	wearalign - wearable data aligned

Wearable devices and modalities/signals:
	Hypnodyne zmax: 
		frontal 2-channel EEG/EOG
		accelerometer (3-Dimensional)
		PPG (Photoplethysmography or blood volume pulse BVP)
		battery
	Empathica E4
		accelerometer (3-Dimensional)
		BVP
	Activpal
		
	mobile surveyapp
		
		
Steps and Status: 

step 0: parsing the file stucture and finding the relevant wearable files
	-> storing in an wearabout.csv:
	['subject_id', 'filepath', 'period', 'datatype', 'device_wearable', 'session']
	status: done
	
step 1.1: reading, preprocessing, concatenation and data export
	Hypnodyne zmax -> merging of channels in one file per session, saving as a zipped and compressed EDF
	Empathica E4 -> merging all in one file per session to have data of multiple files in a timestamped csv
	-> recreating wearabout.csv without reprocessing the new files
	status: zmax, E4  done, Actipal and mobile survey missing

step 1.2: checking data and file structure integrity
	e.g. if all the zmax file dates and data length make sense or need to be adjusted
	what files are present and which not but are expected

QUEST: ist there enought space to store the wearable data a second time?

step 2.1: recording date and time extraction
	-> extending wearabout.csv by info of all four devices:
	[... 'rec_start_datetime', 'rec_stop_datetime', 'rec_duration_datetime', 'sampling_rate_max_Hz']
	
step 2.2: data quality extraction
	-> extending wearabout.csv by info of all four devices:
	[... 'data_quality_indicator' ] (e.g. Battery status at end of zmax, SD of signals or flat lines)

step 3: internal representation for computation and feature generation:
	data is put into similar dataformat (python mne.io.Raw format)

step 4: common feature/modalities generation (for synch by overlap)
	signals for alignment:
		continous heart rate signal (down sampled to 1 Hz)
		continous accelerometer signal (1 second block activity)
	zmax and E4 signal generation from PPG and BVP and accelerometer
	status: in progress, needs testing

step 5.1: aligning and synchronization
	Empathica is used as reference time to the other devices to align time series data
	using cross-correlation in short segments to align data with common modalities
	handle missing boundaries/data or gaps in synch data
	indicate if the data is synchable

	
step 5.2: align and synch info generation
	-> extending wearabout.csv by info of all four devices:
	[... 'rec_start_datetime_referenc', 'rec_stop_datetime_reference', 'rec_duration_datetime_reference', 'sampling_rate_max_Hz_reference_adaption']
	
step 6.1: find all relevant data given a request
	request: datetime start, datetime stop, subject ids, visits(1|2|3|all), periods(pre-1|pre-2|pre-3|all), session(), datatype(wrb|app|all), wearables(zmx|emp|apl|app|all), dateref(aligned|original), age(range), gender(m|f)
	optional if data should be aligned or if the original times are requrested
	done by filtering wearabout.csv and create subset of wearaboutnow.csv
	adding info to wearaboutnow.csv time offsets in seconds for each file

QUEST: ist age, gender, date visit available in a spreadsheet,(date visit is available in files in the subfolder)
	sub-HB0136338856769
	--|date_visit1.txt
	--|date_visit2.txt
	--|date_visit3.txt

QUEST: what are the selectable features to implement?

step 6.2: get the relevant files and snippets
	copy and load the relevant files for alignment into a temporaly location with the wearaboutnow.csv with paths relative to the temporary folder
	
QUEST: what other folders and info should be found for later copying? Should they also be parsed and preprocessed? How will the researchers access this data

QUEST: is this enough support for researchers to work out the rest regardin the wearable and mobile app data?

step 6.3: optional, merge in a common data format all the data	
	resample of the data to align with the reference time line?
	costs a lot of computation and/or extra space
	needed by researchers to have a common format beyond the preprocessed?

			

HB root folder structure for wearables:

sub-HB0136338856769
--|date_visit1.txt
--|date_visit2.txt
--|date_visit3.txt
--|crf
--|lab-1
--|lab-2
--|lab-3
--|pre-1
--|--|app
--|--|--|sub-HBEMA5183016_pre-1_app-ema.csv
--|--|wrb
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl.datx
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl.pml
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_combined_pd_data.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_combined_wk_data.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_logdata.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_slnwlist.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_sumdata.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_tagged_events.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl_valid_periods.csv
--|--|--|sub-HB1AP1618436_pre-1_wrb_apl-evs.csv
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_01.zip
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_02.zip
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_03.zip
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_04.zip
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_05.zip
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_06.zip
--|--|--|sub-HB1EM6570669_pre-1_wrb_emp_full.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp_01.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp_02.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp_03.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp_04.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp_05.zip
--|--|--|sub-HB1EM8057291_pre-1_wrb_emp_06.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_1.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_2.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_3.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_4.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_5.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_6.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_7.zip
--|--|--|sub-HB1ZM3321037_pre-1_wrb_zmx_raw.zip
--|pre-2
--|pre-3
--|pst-1
--|pst-2
--|pst-3
--|qst
sub-HB0139930729424
sub-HB0037923118974
sub-HB0063396839740
sub-HB0070445226012
sub-HB0087095682539
sub-HB0096744832326
sub-HB0108728545230
sub-HB0109563627639
sub-HB0116859417067